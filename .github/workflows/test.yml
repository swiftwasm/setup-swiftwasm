name: "units-test"
on:
  pull_request:
  push:
    branches:
      - main
      - 'releases/*'

jobs:
  # unit tests
  units:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - run: npm ci
    - run: npm test

  test:
    strategy:
      fail-fast: true
      matrix:
        include:
        - os: macos-11
        - os: ubuntu-latest
          container: swift:6.0.3
        - os: ubuntu-latest
          container: swift:6.0.3-amazonlinux2
    runs-on: ${{ matrix.os }}
    container: ${{ matrix.container }}
    steps:
    - uses: actions/checkout@v4
    - run: swift --version
    - uses: ./
    - run: |
        mkdir -p /tmp/hello
        cd /tmp/hello
        swift package init --type executable
        swift build --swift-sdk wasm32-unknown-wasi
